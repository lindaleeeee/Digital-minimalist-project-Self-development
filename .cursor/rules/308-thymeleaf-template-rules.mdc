---
description: Thymeleaf template engine conventions and best practices
globs: ["**/templates/**/*.html", "**/resources/templates/**"]
alwaysApply: false
---
# Thymeleaf Template Rules

## Template Structure
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="${pageTitle}">Default Title</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
  <!-- Use fragments for reusable components -->
  <div th:replace="~{fragments/header :: header}"></div>
  
  <main th:fragment="content">
    <!-- Page-specific content -->
  </main>
  
  <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
```

## Best Practices
- **Natural Templates**: Ensure templates display correctly when opened directly in browser
- **Fragments**: Extract reusable components (header, footer, nav) to `fragments/`
- **Layouts**: Use layout dialect for consistent page structure
- **Security**: Use `th:text` (escapes HTML) instead of `th:utext` unless HTML is trusted

## Common Patterns
```html
<!-- Conditional rendering -->
<div th:if="${user.isAuthenticated}">Welcome, [[${user.name}]]</div>

<!-- Iteration -->
<ul>
  <li th:each="habit : ${habits}" th:text="${habit.name}">Habit</li>
</ul>

<!-- Forms with CSRF -->
<form th:action="@{/api/habits}" method="post" th:object="${habitForm}">
  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
  <input type="text" th:field="*{name}" />
  <button type="submit">Submit</button>
</form>

<!-- URL building -->
<a th:href="@{/habits/{id}(id=${habit.id})}">View Habit</a>
```

## Integration with React
- Use Thymeleaf for server-rendered pages (landing, auth)
- Embed React apps in Thymeleaf templates for SPA sections
- Pass initial data via `th:inline="javascript"`

```html
<div id="react-root"></div>
<script th:inline="javascript">
  window.INITIAL_DATA = /*[[${initialData}]]*/ {};
</script>
```

## See also:
- [306-react-vite-tailwind-rules.mdc](306-react-vite-tailwind-rules.mdc)
