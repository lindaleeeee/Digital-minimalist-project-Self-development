---
description: Environment configuration and secrets management guidelines
globs: ["**/*.env*", "**/application*.yml", "**/application*.properties"]
alwaysApply: false
---
# Environment Configuration Rules

## Environment Files Structure
```
# Development
.env.local              # Local overrides (git-ignored)
.env.development        # Development defaults

# Production
.env.production         # Production config (git-ignored)
.env.example            # Template with dummy values (committed)
```

## Configuration Hierarchy (Spring Boot)
```yaml
# application.yml (common config)
spring:
  application:
    name: digital-minimalist
  profiles:
    active: ${SPRING_PROFILE:development}

---
# application-development.yml
spring:
  config:
    activate:
      on-profile: development
  datasource:
    url: jdbc:postgresql://localhost:5432/digital_minimalist_dev
    
---
# application-production.yml
spring:
  config:
    activate:
      on-profile: production
  datasource:
    url: ${DATABASE_URL}
```

## Environment Variables
```bash
# Database
DATABASE_URL=jdbc:postgresql://localhost:5432/dbname
DATABASE_USERNAME=user
DATABASE_PASSWORD=secret

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=secret

# Kafka
KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# OAuth2
OAUTH2_GOOGLE_CLIENT_ID=xxx
OAUTH2_GOOGLE_CLIENT_SECRET=xxx
OAUTH2_KAKAO_CLIENT_ID=xxx
OAUTH2_KAKAO_CLIENT_SECRET=xxx

# AI Services
OPENAI_API_KEY=sk-xxx
HUGGINGFACE_API_KEY=hf-xxx

# Application
JWT_SECRET=your-secret-key
APP_BASE_URL=http://localhost:8080
```

## Security Best Practices
- ✅ Never commit secrets to version control
- ✅ Use `.env.example` for documentation
- ✅ Rotate secrets regularly (quarterly minimum)
- ✅ Use different secrets for each environment
- ✅ Grant minimum required permissions
- ✅ Consider using secret managers (AWS Secrets Manager, Vault)

## Frontend Environment (Vite)
```typescript
// vite-env.d.ts
interface ImportMetaEnv {
  readonly VITE_API_BASE_URL: string
  readonly VITE_OAUTH_REDIRECT_URI: string
}

// Usage: Only VITE_ prefixed vars are exposed to client
const apiUrl = import.meta.env.VITE_API_BASE_URL
```

## .gitignore Essentials
```
.env.local
.env.*.local
.env.production
application-production.yml
application-local.yml
secrets/
```

## See also:
- [101-build-and-env-setup.mdc](101-build-and-env-setup.mdc)
- [104-security-oauth2-rules.mdc](104-security-oauth2-rules.mdc)
