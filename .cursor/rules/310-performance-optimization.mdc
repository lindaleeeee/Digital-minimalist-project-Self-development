---
description: Performance optimization guidelines for backend and frontend
globs: 
alwaysApply: false
---
# Performance Optimization Rules

## Backend Optimization (Spring Boot)

### Database Query Optimization
```java
// Use @EntityGraph to avoid N+1 queries
@EntityGraph(attributePaths = {"user", "tags"})
List<Habit> findAllWithUserAndTags();

// Use pagination for large datasets
Page<Habit> findByUserId(Long userId, Pageable pageable);

// Implement database indexes on frequently queried columns
@Table(indexes = {
  @Index(name = "idx_user_id", columnList = "user_id"),
  @Index(name = "idx_created_at", columnList = "created_at")
})
```

### Caching Strategy
- **Cache frequently accessed data**: User profiles, app configurations
- **Set appropriate TTL**: User data (5 min), static data (1 hour)
- **Implement cache invalidation**: On data updates
```java
@Cacheable(value = "habits", key = "#userId")
public List<Habit> getUserHabits(Long userId) { /* ... */ }

@CacheEvict(value = "habits", key = "#userId")
public void updateHabit(Long userId, Habit habit) { /* ... */ }
```

### Async Processing
```java
// Use @Async for non-blocking operations
@Async
public CompletableFuture<AnalyticsReport> generateReport(Long userId) {
  // Long-running task
  return CompletableFuture.completedFuture(report);
}
```

## Frontend Optimization (React)

### Code Splitting
```typescript
// Lazy load routes
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Analytics = lazy(() => import('./pages/Analytics'));

<Suspense fallback={<LoadingSpinner />}>
  <Routes>
    <Route path="/dashboard" element={<Dashboard />} />
  </Routes>
</Suspense>
```

### Memoization
```typescript
// useMemo for expensive computations
const sortedHabits = useMemo(() => 
  habits.sort((a, b) => b.priority - a.priority),
  [habits]
);

// useCallback for stable function references
const handleHabitToggle = useCallback((id: string) => {
  toggleHabit(id);
}, [toggleHabit]);
```

### Image Optimization
- Use WebP format with fallbacks
- Implement lazy loading: `<img loading="lazy" />`
- Serve responsive images with srcset

### Bundle Optimization
- Tree shaking: Use ES modules, avoid default exports
- Analyze bundle: `npm run build -- --analyze`
- Target modern browsers to reduce polyfills

## Monitoring & Metrics
- Track Core Web Vitals (LCP, FID, CLS)
- Monitor API response times (p50, p95, p99)
- Set performance budgets (bundle < 200KB initial)

## See also:
- [303-spring-redis-lettuce-redisson-rules.mdc](303-spring-redis-lettuce-redisson-rules.mdc)
- [306-react-vite-tailwind-rules.mdc](306-react-vite-tailwind-rules.mdc)
